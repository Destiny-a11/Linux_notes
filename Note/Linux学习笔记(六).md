# Linux学习笔记(六)

#### 1、日志管理

```
查询Linux中的rsyslogd服务是负启动：
	ps aux | grep “rsyslog” | grep -v “grep”
查询rsyslogd服务的自启状态：
	systemctl list-unit-files | grep rsyslog
```

```
编辑文件时的格式为:	*.*		存放日志文件
其中第一个*代表日志类型，第二个*代表日志级别
日志类型为：
	auth		#pam产生的日志
	authpriv	#ssh、ftp等登录信息的验证信息
	corn		#时间任务相关
	kern		#内核
	lpr		#打印
	mail		#邮件
	mark(syslog)-rsyslog	#服务内部的信息，时间标识
	news		#新闻组
	user		#用户程序产生的相关信息
	uucp		#unix to nuix copy主机之间相关的通信
	local 1-7	#自定义的日志设备

日志级别：
	debug		#有调试信息的，日志通信最多
	info		#一般信息日志，最常用
	notice		#最具有重要性的普通条件的信息
	warning		#警告级别
	err		#错误级别，阻止某个功能或者模块不能正常工作的信息
	crit		#严重级别，阻止整个系统或者整个软件不能正常工作的信息
	alert		#需要立刻修改的信息
	emerg		#内核崩溃等重要信息
	none		#什么都不记录
	注意:从上到下，级别从低到高，记录信息越来越少
```

```
由日志服务rsyslogd记录的日志文件，日志文件的格式包含以下4列:
	事件产生的时间
	产生事件的服务器的主机名
	产生事件的服务名或程序名
	事件的具体信息
```

```
日志轮替：
	logrotate
参数					参数说明
--------------------------------------------------
daily				 日志的轮替周期是每天
weekly				 日志的轮替周期是每周
monthly				 日志的轮替周期是每月
rotate 数字		       保留的日志文件的个数。0指没有备份
compress			 日志轮替时，旧的日志进行压缩
create mode owner group  	 建立新日志，同时指定新日志的权限与所有者和所属组。
mail address			 当日志轮替时，输出内容通过邮件发送到指定的邮件地址。
missingok			 如果日志不存在，则忽略该日志的警告信息
notifempty			 如果日志为空文件，则不进行日志轮替
minsize	大小		       日志轮替的最小值。也就是日志一定要达到这个最小值才会轮替，否则就算时间达到也不轮替
size 大小			       日志只有大于指定大小才进行日志轮替，而不是按照时间轮替。
dateext				 使用日期作为日志轮替文件的后缀。
sharedscripts		 	 在此关键字之后的脚本只执行一次。
prerotate/endscript	 	 在日志轮替之前执行脚本命令。
postrotate/endscript 		 在日志轮替之后执行脚本命令。
```

```
查看内存日志：
journalctl				#查看全部
journalctl -n 3				#查看最新3条
joumalctl --since 19:00--until 19:10:10		#查看起始时间到结束时间的日志可加日期
journalctl -p err	   		#报错日志
journalctl -o verbose			#日志详细内容
jourmalctl_PID=1245 _COMM=sshd 		#查看包含这些参数的日志（在详细日志查看，或者journalctl | grep sshd）
```

#### 2、升级内核

```
uname -a 			//查看当前的内核版本
yum info kernel -q		//检测内核版本，显示可以升级的内核
yum update kernel		//升级内核
yum list kernel -q		//查看已经安装的内核
```

3、备份

```
安装dump:
	yum -y install dump
dump支持分卷和增量备份〈所谓增量备份是指备份上次备份后修改/增加过的文件，也称差异备份）。
dump 选项 目录或文件系统

选项说明：
	-c(0123456789): 备份的层级。0为最完整备份，会备份所有文件。若指定0以上的层级，则备份至上一次备份以来修改或新增的文件,到9后，可以再次轮替.
	-f<备份后文件名>:指定备份后文件名
	-j:调用bzlib 库压缩备份文件，也就是将备份后的文件压缩成bz2格式，让文件更小
	-T<日期>:指定开始备份的时间与日期
	-u :备份完毕后，在/etc/dumpdares中记录备份的文件系统，层级，日期与时间等。
	-t :指定文件名，若该文件已存在备份文件中，则列出名称
	-W:显示需要备份的文件及其最后一次备份的层级，时间，日期。
	-w:与-W类似，但仅显示需要备份的文件。
```

```
备份文件或者目录：
	前面我们在备份分区时，是可以支持增量备份的，如果备份文件或者目录，不再支持增量备份，即只能使用0级别备份
```

4、恢复

```
安装restore：
	yum -y install restore
restore 模式选项 选项
	
说明下面四个模式，不能混用，在一次命令中，只能指定一种。
	-C:使用对比模式，将备份的文件与已存在的文件相互对比。
	-i:使用交互模式，在进行还原操作时，restors 指令将依序询问用户
	-r:进行还原模式
	-t:查看模式，看备份文件有哪些文件
	
选项说明：
	-f<备份设备>:从指定的文件中读取备份数据，进行还原操作
```

