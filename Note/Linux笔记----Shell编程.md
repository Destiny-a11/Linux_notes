# Linux笔记----Shell编程

#### 1、脚本格式

```
脚本以 #!/bin/bash 开头
脚本需要有可执行权限
单行注释：
	#内容
多行注释：
	:<<!
		内容
	!
```

#### 2、脚本执行方式

```
方式一：
	首先赋予脚本可执行权限
	然后通过输入绝对路径或相对路径执行

方式二：
	sh 相对路径/绝对路径
```

#### 3、Shell的变量

```
定义变量：变量名=值
撤销变量：unset 变量
声明静态变量：readonly 变量，注意不能unset
```

```
规则：
	变量名称可以由字母、数字和下划线组成，但是不能以数字开头。
	等号两侧不能有空格。
	变量名称一般习惯为大写，这是一个规范，我们遵守即可。
```

```
将命令的返回值赋给变量
	A='date'反引号，运行里面的命令，并把结果返回给变量A
	A=$(date)等价于反引号
```

#### 4、设置环境变量

```
export变量名=变量值	(功能描述:将shell变量输出为环境变量/全局变量)
source 配置文件		  (功能描述:让修改后的配置信息立即生效)
echo $变量名		   (功能描述:查询环境变量的值)
```

#### 5、位置参数

```
$n	(功能描述:n为数字，$0代表命令本身，$1-$9代表第一到第九个参数，十以上的参数，十以上的参	数需要用大括号包含，如${10})
$*	(功能描述:这个变量代表命令行中所有的参数，$*把所有的参数看成一个整体)
$@	(功能描述:这个变量也代表命令行中所有的参数，不过$@把每个参数区分对待)
$#	(功能描述:这个变量代表命令行中所有参数的个数)
```

#### 6、预定义变量

```
$$	(功能描述:当前进程的进程号(PID) )
$!	(功能描述:后台运行的最后一个进程的进程号(PID))
$?	(功能描述:最后一次执行的命令的返回状态。如果这个变量的值为0，证明上一个命令正确执行;如果	  这个变量的值为非О(具体是哪个数，由命令自己来决定)，则证明上一个命令执行不正确了。)
```

#### 7、运算符

```
方式一：
	$((运算式))
方式二：(推荐)
	$[运算式]
方式三：
	expr m + n
```

```
使用方式三注意事项：
	注意expr运算符间要有空格,如果希望将expr的结果赋给某个变量，使用''
	expr m - n  #必须要有空格
	expr !*,/ ,%	乘，除，取余
```

#### 8、条件判断

```
[ 条件 ] 注意：条件前后要有空格
非空返回true

判断语句常用判断条件：
		=	字符串比较
	两个整数的比较：
        -lt		小于
        -le		小于等于
        -eq		等于
        -g		大于
        -ge		大于等于
        -ne		不等于
    按照文件权限进行判断：
    	-r		有读的权限
		-w		有写的权限
		-x		有执行的权限
	按照文件类型进行判断：
		-f		文件存在并且是一个常规的文件
		-e		文件存在
		-d		文件存在并是一个目录
```

#### 9、if判断

```
if[ 条件 ]
then
	代码
elif[ 条件 ]
then 
	代码
fi
```

#### 10、case语句

```
case $变量名 in
“值1”)
代码
;;
"值2")
代码
;;
*)
如果变量的值都不是以上的值，则执行此程序
;;
esac
```

#### 11、for循环

```
基本语法1：
	for 变量 in 值1 值2 ...
	do
		代码
	done
	
基本语法2：
	for((初始值;循环控制条件;变量变化))
	do
		代码
	done
```

#### 12、while循环

```
while [ 条件判断式 ]
do
	代码
done
```

#### 13、read读取控制台输入

```
read 选项 参数
选项：
	-p	指定读取值时的提示符
	-t	指定读取时等待的时间（秒），如果没有在指定时间内输入，就不在等待
参数：
	变量：指定读取值的变量名
```

#### 14、系统函数

```
basename基本语法：
	功能:返回完整路径最后/的部分，常用于获取文件名
	basename [pathname] [suffix]
	basename [string] [suffix]	(功能描述: basename命令会删掉所有的前缀包括最后一个									(/'）字符，然后将字符串显示出来。
	选项：
		suffix为后缀，如果suffix被指定了，basename会将 pathname或string 中的suffix 			去掉。
```

```
dirname基本语法：
	功能:返回完整路径最后/的前面的部分，常用于返回路径部分
dirname 文件绝对路径	（功能描述:从给定的包含绝对路径的文件名中去除文件名(非目录的部分)，然					 后返回剩下的路径（目录的部分))
```

#### 15、自定义函数

```
function 函数名()
{
	代码
}

调用：
	函数名(值)
```

#### 16、备份数据库

```
要求：
    每天凌晨2:30备份数据库hspedu到/data/backupldb
    备份开始和备份结束能够给出相应的提示信息
    备份后的文件要求以备份时间为文件名，并打包成.tar.gz 的形式，比如:2021-03-12_230201.tar.gz
    在备份的同时，检查是否有10天前备份的数据库文件，如果有就将其删除。
```

```
#备份目录
BACKUP=/data/backup/db
#当前时间
DATETIME=$(date +%Y-%m-%d_%H%M%S)
echo $DATETIME
#数据库的地址
HOST=localhost
#数据库用户名
DB_USER=root
#数据库密码
DB_PW=hspedu100
#备份的数据库名
DATABASE=hspedu
#创建备份目录，如果不存在，就创建
[ ! -d "${BACKUP}/${DATETIME}" ]&& mkdir -p "${BACKUP}/${DATETIME}"
#备份数据库
mysqldump-u${DB_USER} -p${DB_PW}--host=S{HOST} -qR--databases ${DATABASE} / gzip>${BACKUP}/S{DATETIME},/SDATETIME.sql.gz
#将文件处理成tar.gz
cd ${BACKUP}
tar -zcvf $DATETIME.tar.gz ${DATETIME}#删除对应的备份目录
rm -rf ${BACKUP}/S{DATETIME}
#删除10天前的备份文件
find ${BACKUP} -atime +10 -name ""*.tar.gz" -exec rm -rf 
echo "备份数据库S{DATABASE}成功~"

```